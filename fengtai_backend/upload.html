<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>台胞信息录入表单</title>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <script src="https://unpkg.com/vue@3"></script>
    <script src="https://unpkg.com/element-plus"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #1a6dcc 0%, #3e98ff 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .header h1 {
            font-size: 22px;
            font-weight: 600;
        }
        .header p {
            opacity: 0.9;
            margin-top: 5px;
            font-size: 14px;
        }
        .header-icon {
            font-size: 32px;
            opacity: 0.9;
        }
        .form-container {
            padding: 30px;
        }
        .section-title {
            font-size: 18px;
            color: #1a6dcc;
            margin: 25px 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 1px solid #eaeef2;
            font-weight: 600;
        }
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 22px;
        }
        .form-group {
            flex: 1;
        }
        .el-form-item {
            margin-bottom: 22px;
        }
        .avatar-uploader {
            display: flex;
            align-items: center;
        }
        .avatar {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            object-fit: cover;
            border: 1px dashed #dcdfe6;
            margin-right: 15px;
        }
        .upload-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 10px 16px;
            background-color: #f5f7fa;
            border-radius: 6px;
            border: 1px dashed #c0c4cc;
            cursor: pointer;
            transition: all 0.3s;
        }
        .upload-btn:hover {
            border-color: #3e98ff;
            color: #3e98ff;
        }
        .upload-icon {
            margin-right: 6px;
            font-size: 14px;
        }
        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 10px;
        }
        .year-input-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .family-table {
            margin-bottom: 15px;
            border-radius: 6px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }
        .family-input-group {
            display: flex;
            gap: 10px;
        }
        .submit-btn {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            margin-top: 20px;
            background: linear-gradient(135deg, #1a6dcc 0%, #3e98ff 100%);
            border: none;
        }
        .submit-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(26, 109, 204, 0.3);
        }
        .hint-text {
            font-size: 13px;
            color: #909399;
            margin-top: 6px;
        }
        .required-label:after {
            content: "*";
            color: #f56c6c;
            margin-left: 4px;
        }
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            .year-input-group, .family-input-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <div class="header">
                <div>
                    <h1>台胞信息录入</h1>
                    <p>请填写台胞详细信息，带<span style="color: #ffdf5e">*</span>号为必填项</p>
                </div>
                <div class="header-icon">
                    <i class="fas fa-user-circle"></i>
                </div>
            </div>

            <div class="form-container">
                <el-form :model="form" label-width="100px" label-position="left">
                    <!-- 基本信息部分 -->
                    <h3 class="section-title">基本信息</h3>
                    
                    <!-- 头像 -->
                    <el-form-item label="头像" class="required-label">
                        <div class="avatar-uploader">
                            <img v-if="form.avatar" :src="form.avatar" class="avatar" alt="头像">
                            <img v-else :src="defaultAvatar" class="avatar" alt="默认头像">
                            <div class="upload-btn" @click="triggerUpload">
                                <i class="fas fa-cloud-upload-alt upload-icon"></i>
                                <span>上传头像</span>
                            </div>
                            <input type="file" ref="fileInput" @change="handleAvatarUpload" accept="image/*" style="display: none">
                        </div>
                        <div class="hint-text">支持JPG、PNG格式，大小不超过2MB</div>
                    </el-form-item>

                    <!-- 姓名 -->
                    <el-form-item label="姓名" class="required-label">
                        <el-input v-model="form.name" placeholder="请输入台胞姓名" clearable></el-input>
                    </el-form-item>

                    <!-- 个人信息 -->
                    <el-form-item label="个人信息" class="required-label">
                        <el-input type="textarea" v-model="form.info" placeholder="请输入台胞的个人信息、背景介绍等" :rows="4"></el-input>
                    </el-form-item>

                    <!-- 籍贯信息部分 -->
                    <h3 class="section-title">籍贯信息</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <el-form-item label="省份" class="required-label">
                                <el-select v-model="form.province" placeholder="请选择省份" filterable>
                                    <el-option v-for="province in provinces" :key="province" :label="province" :value="province"></el-option>
                                </el-select>
                            </el-form-item>
                        </div>
                        <div class="form-group">
                            <el-form-item label="城市" class="required-label">
                                <el-select v-model="form.city" placeholder="请选择城市" filterable :disabled="!form.province">
                                    <el-option v-for="city in cities" :key="city" :label="city" :value="city"></el-option>
                                </el-select>
                            </el-form-item>
                        </div>
                        <div class="form-group">
                            <el-form-item label="区县" class="required-label">
                                <el-select v-model="form.district" placeholder="请选择区县" filterable :disabled="!form.city">
                                    <el-option v-for="district in districts" :key="district" :label="district" :value="district"></el-option>
                                </el-select>
                            </el-form-item>
                        </div>
                    </div>

                    <!-- 到访信息部分 -->
                    <h3 class="section-title">到访信息</h3>
                    
                    <el-form-item label="到访年份" class="required-label">
                        <div class="tags-container">
                            <el-tag v-for="(year, index) in form.visitYears" :key="index" closable @close="removeYear(index)" type="info" size="large">
                                {{ year }}年
                            </el-tag>
                        </div>
                        <div class="year-input-group">
                            <el-input v-model="yearInput" placeholder="请输入1949-2025之间的年份" @keyup.enter="addYear"></el-input>
                            <el-button type="success" @click="addYear" :disabled="!isValidYear">添加到访年份</el-button>
                        </div>
                        <div class="hint-text">输入年份后按回车或点击按钮添加</div>
                    </el-form-item>

                    <!-- 家族关系部分 -->
                    <h3 class="section-title">家族关系</h3>
                    
                    <el-form-item label="家庭成员" class="required-label">
                        <el-table :data="form.family" class="family-table" empty-text="暂无家庭成员">
                            <el-table-column prop="relation" label="关系" width="120"></el-table-column>
                            <el-table-column prop="name" label="姓名" width="180"></el-table-column>
                            <el-table-column label="操作" width="80">
                                <template #default="{ $index }">
                                    <el-button type="danger" circle plain @click="removeFamily($index)" size="small">
                                        <i class="fas fa-times"></i>
                                    </el-button>
                                </template>
                            </el-table-column>
                        </el-table>

                        <div class="family-input-group">
                            <el-select v-model="familyRelation" placeholder="选择关系" style="width: 150px;">
                                <el-option v-for="item in relations" :key="item" :label="item" :value="item"></el-option>
                            </el-select>
                            <el-input v-model="familyName" placeholder="请输入家庭成员姓名"></el-input>
                            <el-button type="success" @click="addFamily" :disabled="!familyRelation || !familyName">添加成员</el-button>
                        </div>
                    </el-form-item>

                    <!-- 提交按钮 -->
                    <el-form-item>
                        <el-button type="primary" class="submit-btn" @click="submitForm">提交台胞信息</el-button>
                    </el-form-item>
                </el-form>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed } = Vue;
        
        createApp({
            setup() {
                const defaultAvatar = ref('https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png');
                const fileInput = ref(null);
                
                const form = ref({
                    avatar: "",
                    name: "",
                    province: "",
                    city: "",
                    district: "",
                    info: "",
                    visitYears: ["2008", "2021"],
                    family: [
                        { relation: "爷爷", name: "蒋生挺" },
                        { relation: "父亲", name: "蒋孝天" },
                        { relation: "母亲", name: "王慧菊" },
                        { relation: "姐姐", name: "蒋音甄" },
                    ],
                });
                
                const yearInput = ref("");
                const familyRelation = ref("");
                const familyName = ref("");
                
                const provinces = ref(['浙江省', '江苏省', '福建省', '广东省']);
                const cities = ref(['杭州市', '宁波市', '温州市', '嘉兴市']);
                const districts = ref(['西湖区', '鄞州区', '海曙区', '江北区']);
                const relations = ref(['父亲', '母亲', '爷爷', '奶奶', '哥哥', '姐姐', '弟弟', '妹妹', '儿子', '女儿']);
                
                const isValidYear = computed(() => {
                    const year = parseInt(yearInput.value);
                    return !isNaN(year) && year >= 1949 && year <= 2025;
                });
                
                const triggerUpload = () => {
                    fileInput.value.click();
                };
                
                const handleAvatarUpload = (event) => {
                    const file = event.target.files[0];
                    if (file) {
                        if (file.size > 2 * 1024 * 1024) {
                            ElMessage.error('头像图片大小不能超过2MB');
                            return;
                        }
                        
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            form.value.avatar = e.target.result;
                            ElMessage.success('头像上传成功');
                        };
                        reader.readAsDataURL(file);
                    }
                };
                
                const addYear = () => {
                    if (isValidYear.value) {
                        form.value.visitYears.push(yearInput.value);
                        yearInput.value = "";
                        ElMessage.success('已添加到访年份');
                    } else {
                        ElMessage.error('请输入1949-2025之间的有效年份');
                    }
                };
                
                const removeYear = (index) => {
                    form.value.visitYears.splice(index, 1);
                    ElMessage.info('已删除到访年份');
                };
                
                const addFamily = () => {
                    if (familyRelation.value && familyName.value) {
                        form.value.family.push({
                            relation: familyRelation.value,
                            name: familyName.value,
                        });
                        familyRelation.value = "";
                        familyName.value = "";
                        ElMessage.success('已添加家庭成员');
                    }
                };
                
                const removeFamily = (index) => {
                    form.value.family.splice(index, 1);
                    ElMessage.info('已删除家庭成员');
                };
                
                const submitForm = () => {
                    // 表单验证逻辑
                    if (!form.value.avatar) {
                        ElMessage.error('请上传头像');
                        return;
                    }
                    if (!form.value.name) {
                        ElMessage.error('请输入姓名');
                        return;
                    }
                    if (!form.value.province || !form.value.city || !form.value.district) {
                        ElMessage.error('请完善籍贯信息');
                        return;
                    }
                    if (!form.value.info) {
                        ElMessage.error('请输入个人信息');
                        return;
                    }
                    if (form.value.visitYears.length === 0) {
                        ElMessage.error('请至少添加一个到访年份');
                        return;
                    }
                    if (form.value.family.length === 0) {
                        ElMessage.error('请至少添加一个家庭成员');
                        return;
                    }
                    
                    // 提交表单逻辑
                    ElMessage.success('台胞信息提交成功！');
                    console.log('表单数据:', form.value);
                };
                
                return {
                    defaultAvatar,
                    fileInput,
                    form,
                    yearInput,
                    familyRelation,
                    familyName,
                    provinces,
                    cities,
                    districts,
                    relations,
                    isValidYear,
                    triggerUpload,
                    handleAvatarUpload,
                    addYear,
                    removeYear,
                    addFamily,
                    removeFamily,
                    submitForm,
                };
            }
        }).use(ElementPlus).mount('#app');
    </script>
</body>
</html>